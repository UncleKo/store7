{% extends "blog/base.html" %}

{% load wagtailimages_tags wagtailcore_tags %}

{% block content %}

{% if category %}
<small>カテゴリー: </small>
<h2 class="archive-heading">{{ category.name }}</h2>
{% elif tag %}
<small>タグ: </small>
<h2 class="archive-heading">{{ tag.name }}</h2>
{% elif view.kwargs.username %}
<small>Posts By </small>
<h2 class="archive-heading">{{ view.kwargs.username }} ({{ page_obj.paginator.count }})</h2>
{% elif is_archives %}
<small>アーカイブ： </small>
<h2 class="archive-heading">{{ year }}年 {{ month }} 月 </h2>
{% endif %}

<div id="post-list">
  {% for post in posts %}
  <article class="media content-section">
    {% if post.owner.profile.avatar %}
    <img src="{{ post.owner.profile.avatar.url }}" alt="" class="rounded-circle article-img">
    {% endif %}
    <!-- {% image self.blog_authors.first.author.image max-100x100 as img %}
    <img src="{{ img.url }}" alt="" class="rounded-circle article-img"> -->
    <div class="media-body">
      <div class="article-metadata">
        <a class="mr-2" href="">{{ self.owner }}</a>
        <!-- {% for loop_cycle in self.blog_authors.all %}
        <a class="mr-2" href="">{{ loop_cycle.author.name }}</a>
        {% endfor %} -->
        <small class="text-muted">{{ self.first_published_at|date:"Y-m-j" }}</small>
      </div>
      <h2>
        <a class="article-title" href="{{ post.url }}">{{ post.title }}</a>
        <!-- {% if post.draft %}
        <small class="text-danger">（下書き）</small>
        {% endif %} -->
      </h2>

      {% if post.main_contents.first.image %}
      {% image post.main_contents.first.image max-600x600 as img %}
      <img src="{{ img.url }}" alt="" class="featured_image expand-modal">
      <div class="modal">
        {% image post.main_contents.first.image max-1280x1280 as img %}
        <div class="bcimage" style="background-image: url('{{ img.url }}');"></div>
      </div>
      {% endif %}

      <p class="article-content"> {{ post.main_contents.first.text | richtext | slice:":150" }}.....</p>
      <p>
        <a href="{{ post.url }}">続きを読む</a>
      </p>
      <small>カテゴリー:
        {% if post.categories.count %}
        {% for category in post.categories.all %}
        <a href="{% url 'blog:category-view' category.slug %}"}>{{ category }}</a>
        {% endfor %}
        {% else %}
        未分類
        {% endif %}
      </small>
      {% if post.tags.count %}
      <small>タグ:
        {% for tag in post.tags.all %}
        <a href="{% url 'blog:tag-view' tag.slug %}">{{ tag }}</a>
        {% endfor %}
      </small>
      {% endif %}
      <small>コメント: {{ post.approved_comments.count }}</small>
    </div>
  </article>
  {% endfor %}

  <!-- Only for Blog Home -->
  {% if page_obj.has_other_pages %}

  {% if page_obj.has_previous %}
  <a class="btn btn-outline-info mb-4" href="?page=1">
    <i class="fas fa-angle-double-left"></i>
  </a>
  <a class="btn btn-outline-info mb-4" href="?page={{ page_obj.previous_page_number }}">
    <i class="fas fa-angle-left"></i>
  </a>
  {% endif %}

  {% for num in page_obj.paginator.page_range %}
  {% if page_obj.number == num %}
  <a class="btn btn-info mb-4" href="?page={{ num }}">{{ num }}</a>
  {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %} <a class="btn btn-outline-info mb-4"
    href="?page={{ num }}">{{ num }}</a>
    {% endif %}
    {% endfor %}

    {% if page_obj.has_next %}
    <a class="btn btn-outline-info mb-4" href="?page={{ page_obj.next_page_number }}">
      <i class="fas fa-angle-right"></i>
    </a>
    <a class="btn btn-outline-info mb-4" href="?page={{ page_obj.paginator.num_pages }}">
      <i class="fas fa-angle-double-right"></i>
    </a>
    {% endif %}

    {% endif %}

    <!-- Paginate for Categories and Tags -->
    <!-- {% if posts.has_other_pages %}

      {% if posts.has_previous %}
        <a class="btn btn-outline-info mb-4" href="?page=1">First</a>
        <a class="btn btn-outline-info mb-4" href="?page={{ posts.previous_page_number }}">Previous</a>
      {% endif %}

      {% for num in posts.paginator.page_range %}
        {% if posts.number == num %}
          <a class="btn btn-info mb-4" href="?page={{ num }}">{{ num }}</a>
        {% elif num > posts.number|add:'-3' and num < posts.number|add:'3' %}
          <a class="btn btn-outline-info mb-4" href="?page={{ num }}">{{ num }}</a>
        {% endif %}
      {% endfor %}

      {% if posts.has_next %}
        <a class="btn btn-outline-info mb-4" href="?page={{ posts.next_page_number }}">Next</a>
        <a class="btn btn-outline-info mb-4" href="?page={{ posts.paginator.num_pages }}">Last</a>
      {% endif %}

    {% endif %} -->

</div>
<!-- #photo-list -->

{% endblock content %}